@using static BangLuong.ViewModels.BangTinhLuongViewModels
@model PaginatedList<BangTinhLuongViewModel>

@{
    ViewData["Title"] = "Bảng Tính Lương";
}

<h1>@ViewData["Title"]</h1>

<!-- Nút dẫn sang trang tính lương theo kỳ -->
<p>
    <a asp-controller="BangTinhLuong" asp-action="TinhLuongTheoKy" class="btn btn-success mb-3">
        <i class="fas fa-calculator"></i> Tính Lương Theo Kỳ
    </a>
</p>

<!-- Thông báo sau khi tính lương -->
@if (TempData["Message"] != null)
{
    <div class="alert alert-success">@TempData["Message"]</div>
}

<!-- Form tìm kiếm -->
<form asp-action="Index" method="get" class="mb-3">
    <div class="input-group">
        <input type="text" name="searchString" class="form-control" placeholder="Tìm kiếm..." 
               value="@ViewData["CurrentFilter"]" autocomplete="off" />
        <button class="btn btn-secondary" type="submit">Search</button>
    </div>
</form>

<!-- Bảng dữ liệu -->
<table class="table table-bordered table-striped table-hover">
    <thead class="table-light">
        <tr>
            <th>Tháng</th>
            <th>Năm</th>
            <th>Lương cơ bản</th>
            <th>Phụ cấp</th>
            <th>Khen thưởng</th>
            <th>Tiền tăng ca</th>
            <th>Tổng thu nhập</th>
            <th>BHXH</th>
            <th>BHYT</th>
            <th>BHTN</th>
            <th>Khác giảm trừ</th>
            <th>Thuế TNCN</th>
            <th>Thực lĩnh</th>
            @* <th>Trạng thái</th> *@
            <th>Nhân viên</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.KyLuongThang</td>
                <td>@item.KyLuongNam</td>
                <td>@item.LuongCoBan.ToString("N0")</td>
                <td>@(item.TongPhuCap?.ToString("N0") ?? "0")</td>
                <td>@(item.TongKhenThuong?.ToString("N0") ?? "0")</td>
                <td>@(item.LuongTangCa?.ToString("N0") ?? "0")</td>
                <td>@(item.TongThuNhap?.ToString("N0") ?? "0")</td>
                <td>@(item.GiamTruBHXH?.ToString("N0") ?? "0")</td>
                <td>@(item.GiamTruBHYT?.ToString("N0") ?? "0")</td>
                <td>@(item.GiamTruBHTN?.ToString("N0") ?? "0")</td>
                <td>@(item.TongGiamTruKyLuat?.ToString("N0") ?? "0")</td>
                <td>@(item.GiamTruThueTNCN?.ToString("N0") ?? "0")</td>
                <td>@item.ThucLanh.ToString("N0")</td>
                @* <td>@item.TrangThai</td> *@
                <td>@item.MaNV</td>
            </tr>
        }
    </tbody>
</table>

<!-- Phân trang -->
<div class="d-flex justify-content-between align-items-center mt-3">
    <a asp-action="Index" 
       asp-route-pageNumber="@(Model.PageIndex - 1)" 
       asp-route-currentFilter="@ViewData["CurrentFilter"]" 
       class="btn btn-outline-primary @(Model.HasPreviousPage ? "" : "disabled")">
        &laquo; Previous
    </a>

    <span>Page @Model.PageIndex of @Model.TotalPages</span>

    <a asp-action="Index" 
       asp-route-pageNumber="@(Model.PageIndex + 1)" 
       asp-route-currentFilter="@ViewData["CurrentFilter"]" 
       class="btn btn-outline-primary @(Model.HasNextPage ? "" : "disabled")">
        Next &raquo;
    </a>
</div>
